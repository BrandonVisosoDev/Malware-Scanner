# Importamos biblioteclas necesarias

import hashlib
from virus_total_apis import PublicApi
import os
import time
import tkinter as tk
from tkinter import filedialog

# Importamos nuestra API de Virus Total 

API_KEY = ""
api = PublicApi(API_KEY)

# Hacemos una funcion de seleccionar el archivo a escanear

def seleccionar_archivo():
    tipos_archivo = [("Todos los archivos", "*.*")] # Aqui podemos elegir el tipo de archivo / en este caso todos
    ruta_archivo = filedialog.askopenfilename(title="Seleccionar archivo", filetypes=tipos_archivo) # ventana para seleccionar archivo
    
    if ruta_archivo:
        analizar_archivo(ruta_archivo) # Comprobamos que este el archivo en la ruta para poder analizarlo

#  Hacemos Funcion Analizar Archivos con hasheo

def analizar_archivo(ruta_archivo):
    with open(ruta_archivo, "rb") as archivo:
        hash_archivo = hashlib.md5(archivo.read()).hexdigest()
    
    respuesta = api.get_file_report(hash_archivo)
    
    if respuesta["response_code"] == 200:
        antivirus_analizados = respuesta["results"]["total"]
        amenazas_encontradas = respuesta["results"]["positives"]
        
        print(f"El archivo fue analizado por {antivirus_analizados} antivirus.")
        print(f"Se encontraron {amenazas_encontradas} amenazas.")
        
        with open("resultados.txt", "a") as resultados_file:
            resultados_file.write(f"Archivo: {ruta_archivo}\n")
            resultados_file.write(f"Antivirus Analizados: {antivirus_analizados}\n")
            resultados_file.write(f"Amenazas Encontradas: {amenazas_encontradas}\n")
            resultados_file.write("-" * 30 + "\n")
        
        if amenazas_encontradas > 0:
            print("Archivo Infectado")
            time.sleep(2)
            print("Eliminando de Inmediato...")
            os.remove(ruta_archivo)
        else:
            print("Archivo Seguro")
    else:
        print("No se ha logrado obtener el análisis")
    
    # Esperar 5 segundos antes de cerrar la ventana
    raiz.after(5000, raiz.destroy)

# Crear una GUI simple
raiz = tk.Tk()
raiz.withdraw()  # Ocultar la ventana principal

# Llamar a la función para seleccionar y analizar el archivo
seleccionar_archivo()

# Mantener abierta la ventana GUI (opcional)
raiz.mainloop()



